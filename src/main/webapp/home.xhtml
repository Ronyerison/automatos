<!DOCTYPE html>
<html xmlns="http://www.w3c.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<h:head>
	<meta charset="utf-8" />

	<link rel="stylesheet" href="css/joint.css" />
	<script src="js/jquery.min.js"></script>
	<script src="js/lodash.min.js"></script>
	<script src="js/backbone-min.js"></script>
	<script src="js/joint.js"></script>

</h:head>

<h:body>
	
	<h:form id="form">
		<h:inputHidden id="automato" value="#{homeController.nodesJson}" />
	</h:form>

	<div id="paper"></div>
	
	<script type="text/javascript">
		var jsonAutomato = document.getElementById('form:automato').value;
		var automato = JSON.parse(jsonAutomato);
		var estados = automato.estados;
		var graph = new joint.dia.Graph();
	
		var paper = new joint.dia.Paper({
		    el: $('#paper'),
		    width: 800,
		    height: 600,
		    gridSize: 1,
		    model: graph
		});
	
		function state(x, y, label) {
		    
		    var cell = new joint.shapes.fsa.State({
		        position: { x: x, y: y },
		        size: { width: 60, height: 60 },
		        attrs: {
		            text : { text: label, fill: '#000000', 'font-weight': 'normal' },
		            'circle': {
		                fill: '#f6f6f6',
		                stroke: '#000000',
		                'stroke-width': 2
		            }
		        }
		    });
		    graph.addCell(cell);
		    return cell;
		}
	
		function link(source, target, label, vertices) {
		    
		    var cell = new joint.shapes.fsa.Arrow({
		        source: { id: source.id },
		        target: { id: target.id },
		        labels: [{ position: 0.5, attrs: { text: { text: label || '', 'font-weight': 'bold' } } }],
		        vertices: vertices || []
		    });
		    graph.addCell(cell);
		    return cell;
		}


		var start = new joint.shapes.fsa.StartState({ position: { x: 50, y: 530 } });
		graph.addCell(start);
	
		var estadoInicial = state(automato.estadoInicial.info.x, automato.estadoInicial.info.y, automato.estadoInicial.info.label);
		var l = link(start, estadoInicial, 'start');
		var i = 0;
		while(i != automato.transicoes.length) {
			var source = state(automato.transicoes[i].origem.info.x, automato.transicoes[i].origem.info.y, automato.transicoes[i].origem.info.label);
			var target = state(automato.transicoes[i].destino.info.x, automato.transicoes[i].destino.info.y, automato.transicoes[i].destino.info.label);
			var l = link(source, target, automato.transicoes[i].info);
			i++;
		}
		
// 		link(start, code,  'start');
// 		link(code,  slash, '/');
// 		link(slash, code,  'other', [{x: 270, y: 300}]);
// 		link(slash, line,  '/');
// 		link(line,  code,  'new\n line');
// 		link(slash, block, '*');
// 		link(block, star,  '*');
// 		link(star,  block, 'other', [{x: 650, y: 290}]);
// 		link(star,  code,  '/',     [{x: 490, y: 310}]);
// 		link(line,  line,  'other', [{x: 115,y: 100}, {x: 250, y: 50}]);
// 		link(block, block, 'other', [{x: 485,y: 140}, {x: 620, y: 90}]);
// 		link(code,  code,  'other', [{x: 180,y: 500}, {x: 305, y: 450}]);
	</script>
</h:body>
</html>